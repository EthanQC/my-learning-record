## 问题列表
#### 数据库相关
* 你在查询的时候调用的另一个服务宕机了怎么办？
* 数据库的慢查询要怎么优化？
* 分库分表了解吗？项目中有没有实际用到？

#### redis 相关
* 说一下热点 key 和大 key
* 为什么学 redis？是否了解其他分布式缓存技术？
* 讲一下 redis 的缓存雪崩，击穿和穿透

## MySQL 相关

**Q：一条 SQL 查询语句是如何执行的？**

A：

**Q：数据库的事务隔离级别有哪些？**

A：

**Q：事务的四大特性有哪些？MySQL 的执行引擎有哪些？**

A：

**Q：MySQL为什么使用B+树来作索引？**

A：

**Q：说一下索引失效的场景？**

A：

**Q：undo log、redo log、binlog 分别有什么用？**

A：

**Q：你在查询的时候调用的另一个服务宕机了怎么办？**

A：嗯首先在调用失败之前应该就会有一些防御机制，比如超时控制和熔断降级等，同时也可以做有限次数的重试，对于一些可缓存的数据可以从比如说 redis 读取旧数据，当真的出现失败时应该会马上有实时监控的告警，比如钉钉，然后就可以先去看一下日志和告警信息来定位问题，再针对性地解决问题

**Q：数据库的慢查询要怎么优化？**

A：先查一下日志看看是哪些语句是慢查询，然后可以用 EXPLAIN 来分析一下执行计划，看看是否有索引没有命中、全表扫描还是排序开销大等问题，如果是索引没有命中就可以考虑加索引，如果是全表扫描就可以考虑优化 SQL 语句，或者是加一些缓存来减少数据库的压力；另外还可以考虑分库分表来提高性能；索引优化的话可以考虑使用覆盖索引来减少回表的次数，或者是用联合索引来减少索引的数量，也可以删除重复和无用的索引来让优化器更快选出最优索引；如果是排序开销大就可以考虑加一个临时表来存储中间结果，或者是用一些缓存来减少数据库的压力；另外也可以分多几个库，比如主库负责写入，从库负责读取，也可以分区分表来提高性能，或者重新设计表结构，非实时场景可以先写入消息队列然后再异步处理

**Q：分库分表了解吗？项目中有没有实际用到？**

A：有了解，分表就是把一张比较大的表按照某种规则拆分成多张同结构的小表，用来解决单表数据量过大导致的性能问题，比如说可以按时间、ID 或者是地理位置来分表；分库就是把一个数据库拆分成多个数据库，通常是把主库和从库分开，主库负责写入，从库负责读取，这样可以提高性能和可用性；在项目中我还没有实际用到分库分表，因为目前的项目数据量还不大，但我有考虑过在设计时就把这个架构考虑进去，以便后续扩展，比如说可以把用户表和游戏数据表分开，用户表可以按 ID 来分表，游戏数据表可以按时间来分表，这样就能更好地支持高并发和高可用性了；另外在设计时也要考虑到数据的一致性和完整性，比如说在分库分表后要保证跨库事务的一致性，可以使用两阶段提交或者是补偿事务等方式来实现

**Q：如果现在有一个有十亿数据量的大表需要分表，该怎么做，分表之后怎么切业务**

A：嗯首先要选一个既能均匀打散数据又能经常用来查询或关联的字段，比如 user_id 这种的做哈希分配，或者按时间做范围分区，设计好分表规则后就可以创建新的分表，然后把旧表的数据迁移到新表中，迁移时可以先把旧表的数据按规则分批次地插入到新表中，然后再把旧表的数据删除，最后再把旧表删除；在切换业务时可以先把新表的读写权限开放给部分用户进行灰度测试，测试通过后再全面切换到新表；在切换过程中要注意数据的一致性和完整性，比如说在切换前要先备份数据，在切换后要监控数据的一致性和完整性，确保没有数据丢失或错误


## Redis 相关

### 项目相关
**Q：你在项目中使用 Redis 做了什么缓存？能举例说明使用 Redis 带来的性能提升幅度吗？是否做过基准测试或压测？**

A：

**Q：说一下热点 key 和大 key**

A：热点 key 主要是在高并发场景下被频繁读写的同一个 redis key，短时间内 QPS 极高，单点压力过高导致 redis 性能下降，甚至会击穿后端，大 key 则是指 redis 中存储的单个 key 占用内存过大，可能会阻塞 redis 主线程或导致内存溢出、慢查询等问题，解决方法的话可以将单个热点 key 拆成多个子 key，然后对同一 key 并发请求做请求合并，只发一次真实请求，其他请求等待结果复用，也可以把主从节点做读写分离；大 key 的话可以拆分成小 key，然后渐进式迭代访问，分批读取，使用哈希结构这样每次广播可以只做差量更新

**Q：为什么学 redis？是否了解其他分布式缓存技术？**

A：嗯因为 redis 本身是一个性能非常高的内存数据库，有丰富的数据结构，功能也非常强大，既能做缓存也能做消息队列、分布式锁等，使用起来也很方便，正好在项目中也有这方面功能实现的需求，所以我就选择了 redis，目前只是简单学了一下它的使用，底层我还在学习中，现在主要是用它来做项目里的房间状态缓存和游戏事件的快速推送；另外我也了解过其他的分布式缓存技术，比如说 Memcached，它是一个高性能的分布式内存对象缓存系统，主要用于加速动态 Web 应用程序，通过减轻数据库负担来提高性能 ，但它不支持数据持久化和复杂的数据结构，只适合简单的请求缓存

**Q：讲一下 redis 的缓存雪崩，击穿和穿透以及解决方法**

A：缓存穿透是指用户频繁请求不存在的数据，每次都无法在缓存中命中，又直接打到了数据库，这个主要是要对请求参数做合法校验，比如用布隆过滤器，或者直接存一个空值并设置较短的 TTL，这样就可以缓解数据库压力；缓存击穿主要是指某个热点 key 恰好在高并发时刻过期，导致大量并发请求无法命中缓存，同时击穿到数据库做查询或写入，瞬间击垮后端，这个主要要设置热点 key 的过期时间为随机值，也可以使用互斥锁来加锁，只有一个请求能去查询数据库，其他请求等待结果，或后续并发复用同一个结果；缓存雪崩就是指大量缓存，比如整个 redis 实例或大批 key 在同一时间点集中到期，或 redis 整体不可用，导致所有请求都到数据库，形成雪崩式的流量冲击，这个主要是要设置不同的过期时间，避免同一时间点集中到期，同时也可以使用多级缓存，比如在业务进程内做一层 LRU，让热点数据优先走本地，或采用 redis 集群和限流降级