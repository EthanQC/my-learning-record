# 密纸科技
入职时间：2025.2.24

离职时间：还在纠结，合同签到 8.24

上班时间：第一周全勤，后面是周一周二周五上班

## 后端技术栈
公司业务是海外网文平台，我的岗位是后端开发，下面记录公司后端用到的一些技术工具

* 编程语言：php
* 框架：laravel + webman + GatewayWorker
* 数据库：MySQL
    * ORM：Eloquent ORM
    * 可视化：phpMyAdmin
    * 数据管理与图形化界面：SupMes
* 缓存：Redis
* 检索：Elasticsearch
* 接口文档管理：Apifox
* 代码评审和项目管理：Arcanist (arc，命令行工具) + Phabricator
* 仓库管理：GitBucket
* 环境管理：SPUG

## 我的工作
我目前的工作主要是维护和编写新接口，然后写写改改接口文档，跟前端协同确认需求，下面是具体的工作任务记录

* 2025.2.24-2.28，3.3-3.4：**熟悉仓库代码，看公司技术文档**
* 2025.3.7：**修改一个任务模块的接口**
    * 新增“无时效任务”任务类型常量
    * 在原有的日常、周任务基础上新增“无时效任务”参数
    * 添加判断任务类型并根据任务类型设置任务结束时间的逻辑
    * 修改接口文档
    * 本地开发环境测试、提交 review 申请给 mentor
    * 上线测试环境
    * **难点：无**
* 2025.3.7，3.10-3.11：**编写返回书封书名的新接口**
    * 接口功能
        * 从 jwt 中间件获取的已认证的用户ID
        * 根据用户ID，在数据库中查询其近期阅读记录
        * 根据阅读记录查询用户最近阅读的一本书的封面和名字
        * 将数据返回给前端
    * 接口会返回的参数
        * resource_type：资源类型
        * resource_id：资源ID
        * chapter_id：章节ID
        * name：书名
        * cover_pic_url：书封
    * 参数数据结构
        * 加密后均为 string 类型
    * 接口编写逻辑（公司项目架构见下方）
        * 在项目框架路由文件中添加路由
        * Controller 层：响应函数，获取用户ID、调用 Service 层具体逻辑函数，校验获取的数据后返回
        * Service 层：业务逻辑函数，调用 Dao 层数据查询函数获取历史记录，格式化资源信息，处理章节ID获取最新记录，将所有数据转为 string 并加密后返回
        * Dao 层：数据查询函数，ORM 查询数据后返回
    * 编写接口文档，设计数据结构，跟前端对需求
    * 本地开发环境测试、提交 review 申请给 mentor
    * 上线测试环境
    * **难点：**
        **1. 不熟悉 php 技术栈，对仓库中封装好的数据加密和格式化的工具函数看不懂该如何调用**
        * 用 copilot、chatgpt 等工具查资料，了解工具后再使用，再让它们帮忙分析仓库结构、梳理需求逻辑，再不行就请教 mentor，最终成功使用

        **2. 第一次在企业级项目中自己从零开始写接口，缺乏经验，不确定具体该如何设计，不熟悉 review 、测试和 git 流程**
        * 遇到问题就直接问 mentor，根据 mentor 的反馈修改代码，查找并使用自己不清晰的 git 命令，最终成功 merge
* 2025.3.14：**发布接口，看业务需求文档，对接**
    * 将周一周二写的新接口发布到预发布环境
    * 查看业务更新的需求文档，对接前端需求
* 2025.3.17：**发布接口，看需求文档，构思思路**
    * 将上周写的新接口发布到生产环境
        * 发现报错，重新发布后解决
        * mentor 说是他没有讲清楚发生产的具体步骤，准备明天跟我说一下
    * 查看业务更新的需求文档
    * 听 mentor 的构思一下如果是我的话我会怎么写
    * 准备明天跟 mentor 聊之后开始具体开发公司的一个即时通讯的项目
* 2025.3.18：**跟 mentor 聊 IM 该如何写**
    * 确认 IM 的实现方式
    * 看新框架 GatewayWorker 的文档
    * 熟悉框架和仓库代码
* 2025.3.21：**看 GatewayWorker 技术文档**
    * 看技术文档，熟悉 IM 要用的技术框架
    * 看 IM 目前的仓库代码，熟悉当前结构
* 2025.3.24-3.25，3.28：**迁移用户端 IM 模块**
    * 将用户端 IM 的接口迁移到新的 IM 仓库，更改接口相关依赖，梳理并修改各个接口与路由逻辑
        * 迁移了的接口：
        * 创建群组、退出/踢出群组、查询所有群成员
        * 添加群组成员、举报群组成员、解散群组
    * 完善 IM 仓库目前架构
    * 补充一些基础模型、常量代码文件

## 项目架构
公司采用的是比较严格的企业级架构划分，从代码规范到环境管理都比较清晰

* 环境
    * 本地开发环境
    * 测试环境
    * 预发布环境
    * 生产环境

开发环境和测试环境的数据基本一致，预发布与生产环境数据也基本一致，但二者会有些许不同

从环境出发，公司的每个项目都有这几个环境各自的分支，代码从编写到上线也会把这四个环境依次跑一遍，前面三个都不出错才会上生产

* 项目
    * 用户端
    * 运营后台
    * 管理站
    * IM

目前我只接触到了这几个项目，还有个别仓库是类似于工具组件的，等我用到了再说

公司做的是海外网文平台，运营后台是给内容部的同事用的，管理站和 IM 目前我还不是特别清楚各自的用途，用到了会再补充

以用户端为例，下面是公司这个仓库的基本架构

* MVC + service
    * Model 层 ------ 数据模型
    * Service 层 ---- 业务逻辑
    * DAO 层 -------- 数据访问
    * Controller 层 - 处理请求响应

由于这种多封装了一层 service 层的模式，导致代码的可读性相对差一些，需要很强的熟悉度才能读起来比较舒服

仓库也有很多其他的工具组件和其他文件夹，也是等我用到了再记录吧

## 代码流程
* 先写接口文档，设计数据结构，每个接口的路由是什么，然后再写代码
* 写好代码之后，先用 Apifox 在本地开发环境自己测试一遍，不报错没问题再继续
* 运行 `git add .` 将所有修改的文件添加跟踪，运行 `git commit -m "your_description"` 提交到本地仓库
* 然后用 `arc diff` 把代码提交到 Phabricator 给 mentor 评审 review
* review 通过之后关闭 review 申请，创建一个新分支 `git switch -c dev/new branch name`，并推送到远端，记得加 `dev/` 前缀
* 推送完之后用 `git checkout test` 切换到测试分支，运行 `git pull` 更新
* 然后运行 `git merge new-branch-name` 来合并分支，再推送到远程
* 推完之后登录 `https://pubsys.mespery.com/`，新建申请后选择对应的发布环境和应用，再点击发布就行
* 发测试、预发布和生产环境的流程都是差不多的，先切到对应的分支，更新，merge，然后推送

## 其他
* 4.7：搬公司