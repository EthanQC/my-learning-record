## 缓存
#### 为什么需要 Buffer Pool？

MySQL 的数据是存储在**磁盘**上的，中更新一条记录时要先从磁盘读取，然后**在内存中修改**，修改完再缓存到 InnoDB 存储引擎设计的**缓存池**中，这样下次有查询语句命中了这条记录就可以直接读取缓存中的记录，而不需要再去磁盘上读取

有了 Buffer Pool 之后，**读取数据时**，如果数据存在 Buffer Pool 中，就**直接读取**，否则再去磁盘里读取，在**修改数据时**，如果数据存在于 Buffer Pool 中，就直接修改 Buffer Pool 中数据所在的页，然后将这页设置为**脏页**（该页的内存数据和磁盘上的已经不一致），否则就先从磁盘读取到 Buffer Pool 中，然后再修改，为了减少磁盘 I/O，**脏页不会被立即写入磁盘中**，而是后续由后台线程选择合适的时机将脏页写入到磁盘

#### Buffer Pool 会缓存什么？

缓存池跟磁盘一样，也是**以页作为单位进行划分**的，一个页的默认大小是 16 KB，在 MySQL 启动时，InnoDB 会为 Buffer Pool 申请一块**连续**的内存空间，然后将这块内存划分成多个页，Buffer Pool 中的页就叫做**缓存页**，此时这些缓存页都是空闲的，之后随着程序的运行，才会有磁盘上的页被缓存到 Buffer Pool 中

所以，MySQL 刚启动时，会观察到使用的虚拟内存空间很大，而使用到的物理内存空间却很小，就是因为只有这些虚拟内存被访问后，操作系统才会触发页中断，才会申请物理内存，将虚拟内存映射到物理内存上

Buffer Pool 主要会缓存**数据页、索引页、undo 页、插入缓存页、自适应哈希索引和锁信息**等，undo 页记录的就是 undo log，在查询一条记录时，InnoDB 会**将整个页的数据都加载到 Buffer Pool 中**，而不是只加载这条记录的数据，然后再通过页里的**页目录**定位到某条具体的记录

#### 
